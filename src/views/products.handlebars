<link rel="stylesheet" href="/css/style.css">

<nav style="margin-bottom: 20px; text-align: right; padding: 10px;">
    <a href="/carts/698d5ceb0f3d30624b8eab2f" class="btn" style="text-decoration: none; background-color: #28a745;">üõí
        Ver mi Carrito</a>
</nav>

<h1 style="text-align: center; color: #333; margin-bottom: 30px;">Core Tech</h1>

<div class="container">
    {{#each products.docs}}
    <div class="product-card"
        style="display: flex; flex-direction: column; justify-content: space-between; height: 100%;">

        <div
            style="width: 100%; height: 180px; display: flex; align-items: center; justify-content: center; overflow: hidden; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
            {{#if this.thumbnail}}
            <img src="{{this.thumbnail}}" alt="{{this.title}}"
                style="max-width: 100%; max-height: 100%; object-fit: contain;">
            {{else}}
            <img src="/img/no-image.png" alt="Sin imagen" style="width: 50%; opacity: 0.3;">
            {{/if}}
        </div>

        <div>
            <h3 style="margin: 10px 0;">{{this.title}}</h3>
            <p style="font-size: 0.9em; color: #666; height: 40px; overflow: hidden;">{{this.description}}</p>
            <p style="font-size: 1.2em; color: #2c3e50;"><strong>${{this.price}}</strong></p>
        </div>

        <button class="btn" onclick="addToCart('{{this._id}}')" style="width: 100%; margin-top: 10px;">Agregar al
            Carrito</button>
    </div>
    {{/each}}
</div>

<div class="pagination" style="text-align: center; margin-top: 30px; margin-bottom: 50px;">
    {{#if products.prevLink}}
    <a href="{{products.prevLink}}" class="btn" style="background-color: #6c757d; text-decoration: none;">‚¨ÖÔ∏è
        Anterior</a>
    {{/if}}

    <span style="margin: 0 15px; font-weight: bold;">P√°gina {{products.page}} de {{products.totalPages}}</span>

    {{#if products.nextLink}}
    <a href="{{products.nextLink}}" class="btn" style="background-color: #6c757d; text-decoration: none;">Siguiente
        ‚û°Ô∏è</a>
    {{/if}}
</div>

<script>
    async function addToCart(productId) {
        // Mantenemos tu ID de carrito fijo para la prueba
        const cartId = "698d5ceb0f3d30624b8eab2f";

        try {
            const response = await fetch(`/api/carts/${cartId}/product/${productId}`, {
                method: 'POST'
            });

            if (response.ok) {
                Swal.fire({
                    title: '¬°Agregado!',
                    text: 'Producto sumado al carrito',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false,
                    toast: true,
                    position: 'top-end'
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'No se pudo agregar el producto',
                });
            }
        } catch (error) {
            console.error("Error:", error);
        }
    }
</script>