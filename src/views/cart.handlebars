<h1>Tu Carrito de Compras</h1>

<div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1);">
    {{#if cart.products.length}}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #eee; text-align: left;">
                <th style="padding: 10px;">Producto</th>
                <th style="padding: 10px;">Descripci√≥n</th>
                <th style="padding: 10px;">Cantidad</th>
                <th style="padding: 10px;">Precio Unitario</th>
                <th style="padding: 10px;">Subtotal</th>
                <th style="padding: 10px; text-align: center;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {{#each cart.products}}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;"><strong>{{this.product.title}}</strong></td>
                <td style="padding: 10px;">{{this.product.description}}</td>
                <td style="padding: 10px; text-align: center;">{{this.quantity}}</td>
                <td style="padding: 10px;">${{this.product.price}}</td>
                <td style="padding: 10px;">${{multiply this.quantity this.product.price}}</td>
                <td style="padding: 10px; text-align: center;">
                    <button class="btn" style="background-color: #dc3545; cursor: pointer;"
                        onclick="deleteProduct('{{../cart._id}}', '{{this.product._id}}')">
                        üóëÔ∏è
                    </button>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>

    <div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
        <button class="btn" style="background-color: #6c757d;" onclick="emptyCart('{{cart._id}}')">Vaciar
            Carrito</button>

        <div style="text-align: right;">
            <a href="/products" class="btn" style="background-color: gray; text-decoration: none;">Volver a la
                tienda</a>
            <button class="btn" onclick="Swal.fire('¬°Compra exitosa!', 'Tu pedido est√° en camino', 'success')">Finalizar
                Compra</button>
        </div>
    </div>

    {{else}}
    <div style="text-align: center; padding: 30px;">
        <p style="font-size: 1.2rem; color: #666;">El carrito est√° vac√≠o.</p>
        <a href="/products" class="btn" style="text-decoration: none;">Ir a ver productos</a>
    </div>
    {{/if}}
</div>

<script>
    async function deleteProduct(cartId, productId) {
        try {
            const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
                method: 'DELETE'
            });
            const result = await response.json();
            if (result.status === "success") {
                location.reload();
            }
        } catch (error) {
            console.error("Error:", error);
        }
    }

    async function emptyCart(cartId) {
        const confirm = await Swal.fire({
            title: '¬øVaciar carrito?',
            text: "Se eliminar√°n todos los productos",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'S√≠, vaciar',
            cancelButtonText: 'Cancelar'
        });

        if (confirm.isConfirmed) {
            try {
                const response = await fetch(`/api/carts/${cartId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    location.reload();
                }
            } catch (error) {
                console.error("Error:", error);
            }
        }
    }
</script>